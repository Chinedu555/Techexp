<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-60T607VJF3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-60T607VJF3');
</script>
<script data-goatcounter="https://726766.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
    <!-- Chart.js for the growth graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>Rollover Odds Calculator</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Animate.css for animations -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
  <!-- Chart.js for growth chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --glass-bg: rgba(255, 255, 255, 0.9);
      --glass-border: rgba(0, 0, 0, 0.1);
      --success: #16a34a;
      --danger: #dc2626;
      --shadow: 0 8px 32px rgba(2, 6, 23, 0.08);
    }
    body {
      --bg-color: #f5f5f5;
      --text-color: #333;
      background: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
      min-height: 100vh;
      padding-bottom: 60px; /* Space for fixed footer */
    }
    [data-bs-theme="dark"] body {
      --bg-color: #212529;
      --text-color: #f8f9fa;
      --glass-bg: rgba(33, 37, 41, 0.9);
      --glass-border: rgba(255, 255, 255, 0.1);
      --success: #2dd4bf;
      --danger: #f87171;
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }
    [data-bs-theme="dark"] .card {
      background: var(--glass-bg);
      border-color: var(--glass-border);
      color: var(--text-color);
    }
    [data-bs-theme="dark"] .form-control,
    [data-bs-theme="dark"] .btn-outline-secondary {
      background-color: #343a40;
      color: #f8f9fa;
      border-color: #6c757d;
    }
    .card {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 1rem;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
    }
    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
    }
    .counting {
      display: inline-block;
      min-width: 100px; /* Prevents layout shift */
    }
    .table-wrap {
      max-height: 360px;
      overflow: auto;
      border-radius: 0.5rem;
      border: 1px solid var(--glass-border);
    }
    canvas {
      max-height: 360px !important;
    }
    .sticky-bar {
      display: none;
    }
    @media (max-width: 860px) {
      .sticky-bar {
        display: flex;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 12px;
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        gap: 10px;
      }
    }
    @media (prefers-reduced-motion: reduce) {
      .animate__animated, .counting {
        animation: none !important;
        transition: none !important;
      }
    }
    .footer {
      background-color: #222;
      color: #ccc;
      text-align: center;
      padding: 10px;
      position: fixed;
      bottom: 0;
      width: 100%;
      font-size: 14px;
      z-index: 1000;
    }
    .footer span {
      color: #fff;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- Theme Toggle -->

  </div>
    <div class="row g-4">
  <!-- Main Calculator -->
  <div class="container py-4">

        <br /> <br />
      <!-- Left: Inputs + Result -->
      <div class="col-12 col-lg-6">
          
        <section class="card p-4">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="h4 mb-0"> 
                     <div class="form-check form-switch" style=""> 
      <input class="form-check-input" type="checkbox" id="modeToggle" aria-label="Toggle dark mode">
      <label class="form-check-label" for="modeToggle"> 
        <i class="bi bi-sun"></i> <span style="margin-right:left;">üí∞ Rollover</span>
      </label></h2>
          </div>
          <div class="row g-3">
            <div class="col">
              <label for="start" class="form-label">Amount (‚Ç¶)</label>
              <input type="number" id="start" class="form-control" placeholder="e.g. 100" inputmode="decimal" aria-label="Starting amount in Naira">
            </div>
            <div class="col">
              <label for="odds" class="form-label">Daily Odds</label>
              <input type="number" id="odds" class="form-control" step="0.01" placeholder="e.g. 1.5" aria-label="Daily odds">
            </div>
            <div class="col">
              <label for="days" class="form-label">Days</label>
              <input type="number" id="days" class="form-control" placeholder="e.g. 30" aria-label="Number of days">
            </div>
          </div>
          <button class="btn btn-primary w-100 mt-3" id="calcBtn">
            <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            Calculate
          </button>
          <div id="result" class="text-center mt-3 fs-4 fw-bold" aria-live="polite">‚Ç¶0.00</div>
          <div class="text-muted text-center mt-2">
            Tip: Results formatted with commas for quick reading. <a href="withdraw.html">Days Calculator</a>
          </div>
          <div class="d-flex flex-wrap gap-2 mt-3">
            <button class="btn btn-outline-secondary" id="saveBtn" title="Save inputs & last result">Save</button>
            <button class="btn btn-outline-secondary" id="loadBtn" title="Load last saved values">Load</button>
            <button class="btn btn-outline-secondary" id="exportBtn" title="Export daily breakdown to CSV">Export CSV</button>
            <button class="btn btn-outline-secondary" id="clearBtn" title="Clear inputs & outputs">Clear</button>
          </div>
          <p class="text-muted mt-3">
            ‚ö†Ô∏è Disclaimer: Betting rollovers are risky. Only use funds you can afford to lose.
          </p>
        </section>
      </div>
      <!-- Right: Chart + Breakdown -->
      <div class="col-12 col-lg-6">
        <section class="card p-4">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h2 class="h4 mb-0">üìà Growth Chart & Breakdown</h2>
          </div>
          <canvas id="growthChart" aria-label="Growth over days"></canvas>
          <div class="table-wrap mt-3">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th scope="col" style="text-align: left;">Day</th>
                  <th scope="col" style="text-align: right;">Amount (‚Ç¶)</th>
                  <th scope="col" style="text-align: right;">Change (‚Ç¶)</th>
                </tr>
              </thead>
              <tbody id="breakdownTable"></tbody>
            </table>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Sticky actions on mobile -->
  <div class="sticky-bar">
    <button class="btn btn-primary" id="calcBtnSticky" style="display:none;">
      <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"style="display:none;" hidden=""></span>
      Calculate
    </button>
    <button class="btn btn-outline-secondary" id="exportBtnSticky" style="display:none;">Export CSV</button>
  </div>

  <!-- Footer -->
  <div class="footer">
    ¬© <span>Dev Samson C. Uche</span> ‚Äî All rights reserved.
  </div>

  <!-- Bootstrap JS and Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script>
    // Utilities
    const fmt = (n) => (isNaN(n) ? "0.00" :
      n.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 }));

    const animateCount = (el, start = 0, end = 0, duration = 900) => {
      const startTime = performance.now();
      const tick = (now) => {
        const p = Math.min((now - startTime) / duration, 1);
        const eased = 1 - Math.pow(1 - p, 3); // easeOutCubic
        const val = start + (end - start) * eased;
        el.textContent = "‚Ç¶" + fmt(val);
        if (p < 1) requestAnimationFrame(tick);
      };
      requestAnimationFrame(tick);
    };

    const storageKey = "rollover_calc_v1";

    // Elements
    const elStart = document.getElementById("start");
    const elOdds = document.getElementById("odds");
    const elDays = document.getElementById("days");
    const elResult = document.getElementById("result");
    const modeToggle = document.getElementById("modeToggle");
    const calcBtn = document.getElementById("calcBtn");
    const calcBtnSticky = document.getElementById("calcBtnSticky");
    const saveBtn = document.getElementById("saveBtn");
    const loadBtn = document.getElementById("loadBtn");
    const exportBtn = document.getElementById("exportBtn");
    const exportBtnSticky = document.getElementById("exportBtnSticky");
    const clearBtn = document.getElementById("clearBtn");
    const tbody = document.querySelector("#breakdownTable");
    let chart;

    // Theme Toggle
    const themeIcon = modeToggle.nextElementSibling.querySelector("i");
    const applyModeFromStorage = () => {
      const mode = localStorage.getItem("rollover_mode") || 
        (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
      const isLight = mode === "light";
      document.documentElement.setAttribute("data-bs-theme", isLight ? "light" : "dark");
      modeToggle.checked = !isLight;
      themeIcon.classList.toggle("bi-sun", isLight);
      themeIcon.classList.toggle("bi-moon", !isLight);
    };
    modeToggle.addEventListener("change", () => {
      const isDark = modeToggle.checked;
      document.documentElement.setAttribute("data-bs-theme", isDark ? "dark" : "light");
      localStorage.setItem("rollover_mode", isDark ? "dark" : "light");
      themeIcon.classList.toggle("bi-sun", !isDark);
      themeIcon.classList.toggle("bi-moon", isDark);
      console.log("[Mode] Switched to", isDark ? "dark" : "light");
    });

    // Core Calculation
    function calculateAndRender() {
      console.log("[Calculate] Begin calculation.");
      const start = parseFloat(elStart.value);
      const odds = parseFloat(elOdds.value);
      const days = parseInt(elDays.value);

      // Disable buttons
      const buttons = [calcBtn, calcBtnSticky, saveBtn, loadBtn, exportBtn, exportBtnSticky, clearBtn];
      buttons.forEach(btn => {
        btn.disabled = true;
        if (btn.id.includes("calcBtn")) btn.querySelector(".spinner-border").classList.remove("d-none");
      });

      if (isNaN(start) || isNaN(odds) || isNaN(days) || start <= 0 || odds <= 0 || days < 0) {
        elResult.innerHTML = '<div class="alert alert-danger animate__animated animate__fadeIn">‚ö†Ô∏è Please enter valid positive numbers.</div>';
        console.log("[Calculate] Invalid inputs:", { start, odds, days });
        setTimeout(() => {
          buttons.forEach(btn => {
            btn.disabled = false;
            if (btn.id.includes("calcBtn")) btn.querySelector(".spinner-border").classList.add("d-none");
          });
        }, 1000);
        return { series: [], labels: [] };
      }

      // Compute daily amounts
      const amounts = [];
      let curr = start;
      amounts.push(curr);
      for (let d = 1; d <= days; d++) {
        curr *= odds;
        amounts.push(curr);
      }
      const finalAmount = amounts[amounts.length - 1];

      // Animate result
      const currentShown = Number(elResult.textContent.replace(/[^\d.-]/g, "")) || 0;
      elResult.innerHTML = '<span class="counting"></span>';
      animateCount(elResult.querySelector(".counting"), currentShown, finalAmount);

      // Render table and chart with animation
      renderTable(amounts);
      renderChart(amounts);

      // Re-enable buttons
      setTimeout(() => {
        buttons.forEach(btn => {
          btn.disabled = false;
          if (btn.id.includes("calcBtn")) btn.querySelector(".spinner-border").classList.add("d-none");
        });
      }, 1000);

      console.log("[Calculate] Done. Final:", finalAmount);
      return { series: amounts, labels: [...Array(amounts.length).keys()] };
    }

    function renderTable(amounts) {
      console.log("[Table] Rendering", amounts.length, "rows.");
      tbody.innerHTML = "";
      amounts.forEach((amount, i) => {
        const tr = document.createElement("tr");
        tr.className = "animate__animated animate__fadeIn";
        tr.style.animationDelay = `${i * 50}ms`;
        tr.innerHTML = `
          <td style="text-align: left;">${i}</td>
          <td style="text-align: right;">‚Ç¶${fmt(amount)}</td>
          <td style="text-align: right;">${i === 0 ? "‚Äî" : "‚Ç¶" + fmt(amount - amounts[i - 1])}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function renderChart(amounts) {
      const ctx = document.getElementById("growthChart").getContext("2d");
      const labels = amounts.map((_, i) => i);
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "Amount (‚Ç¶)",
            data: amounts,
            borderColor: document.documentElement.dataset.bsTheme === "dark" ? "#2dd4bf" : "#0ea5e9",
            backgroundColor: document.documentElement.dataset.bsTheme === "dark" ? "#2dd4bf33" : "#0ea5e933",
            fill: true,
            tension: 0.18
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { mode: "index", intersect: false },
          plugins: {
            legend: { display: true },
            tooltip: { callbacks: { label: (ctx) => " ‚Ç¶" + fmt(ctx.parsed.y) } }
          },
          scales: {
            x: { title: { display: true, text: "Day" } },
            y: {
              title: { display: true, text: "Amount (‚Ç¶)" },
              ticks: { callback: (v) => "‚Ç¶" + (Number(v) || 0).toLocaleString() }
            }
          },
          animation: {
            duration: 1000,
            easing: "easeOutCubic"
          }
        }
      });
      console.log("[Chart] Rendered with", amounts.length, "points.");
    }

    // Save / Load
    function saveState() {
      const data = {
        start: elStart.value,
        odds: elOdds.value,
        days: elDays.value,
        result: elResult.textContent
      };
      localStorage.setItem(storageKey, JSON.stringify(data));
      console.log("[Storage] Saved:", data);
      alert("Saved!");
    }

    function loadState() {
      const raw = localStorage.getItem(storageKey);
      if (!raw) {
        alert("No saved data found.");
        return;
      }
      const data = JSON.parse(raw);
      elStart.value = data.start ?? "";
      elOdds.value = data.odds ?? "";
      elDays.value = data.days ?? "";
      elResult.textContent = data.result ?? "‚Ç¶0.00";
      console.log("[Storage] Loaded:", data);
      calculateAndRender();
    }

    // Export CSV
    function exportCSV() {
      const start = parseFloat(elStart.value);
      const odds = parseFloat(elOdds.value);
      const days = parseInt(elDays.value);
      if (isNaN(start) || isNaN(odds) || isNaN(days) || start <= 0 || odds <= 0 || days < 0) {
        alert("Please enter valid inputs before exporting.");
        return;
      }
      const amounts = [start];
      let curr = start;
      for (let d = 1; d <= days; d++) {
        curr *= odds;
        amounts.push(curr);
      }
      let csv = "Day,Amount (NGN),Change (NGN)\n";
      amounts.forEach((amount, i) => {
        const change = i === 0 ? "" : (amount - amounts[i - 1]).toFixed(2);
        csv += `${i},${amount.toFixed(2)},${change}\n`;
      });
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "rollover_breakdown.csv";
      a.click();
      URL.revokeObjectURL(url);
      console.log("[Export] CSV rows:", amounts.length);
    }

    // Clear
    function clearAll() {
      elStart.value = "";
      elOdds.value = "";
      elDays.value = "";
      elResult.textContent = "‚Ç¶0.00";
      tbody.innerHTML = "";
      if (chart) chart.destroy();
      console.log("[Clear] Inputs and outputs cleared.");
    }

    // Event Listeners
    calcBtn.addEventListener("click", calculateAndRender);
    calcBtnSticky.addEventListener("click", calculateAndRender);
    saveBtn.addEventListener("click", saveState);
    loadBtn.addEventListener("click", loadState);
    exportBtn.addEventListener("click", exportCSV);
    exportBtnSticky.addEventListener("click", exportCSV);
    clearBtn.addEventListener("click", clearAll);
    [elStart, elOdds, elDays].forEach(inp => {
      inp.addEventListener("keydown", (e) => {
        if (e.key === "Enter") calculateAndRender();
      });
    });

    // Init
    window.addEventListener("DOMContentLoaded", () => {
      console.log("[Init] DOM ready.");
      applyModeFromStorage();
      const saved = localStorage.getItem(storageKey);
      if (saved) {
        try {
          const data = JSON.parse(saved);
          elStart.value = data.start ?? "";
          elOdds.value = data.odds ?? "";
          elDays.value = data.days ?? "";
          console.log("[Init] Loaded saved inputs.");
          if (data.start && data.odds && data.days) calculateAndRender();
        } catch (err) {
          console.warn("[Init] Failed to parse saved state", err);
        }
      }
    });
  </script>
</body>
</html>
